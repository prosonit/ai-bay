# Dockerfile
FROM nvidia/cuda:11.8.0-runtime-ubuntu22.04

# System dependencies (just Python and libaio)
RUN apt-get update && \
    apt-get install -y python3.10 python3-pip libaio1 && \
    ln -sf /usr/bin/python3.10 /usr/bin/python && \
    rm -rf /var/lib/apt/lists/*

# Get pip cache from builder
COPY --from=builder /usr/local/lib/python3.10/dist-packages /usr/local/lib/python3.10/dist-packages

# Copy vLLM CLI and source, in case live reload or source access is wanted
COPY --from=builder /workspace/vllm /workspace/vllm

WORKDIR /workspace

# Set compute capability for PyTorch
ENV TORCH_CUDA_ARCH_LIST="6.1"

# REST API will be on port 8000 by default
EXPOSE 8000

ENTRYPOINT ["vllm"]
CMD []
